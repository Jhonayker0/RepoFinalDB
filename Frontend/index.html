<!-- index.html -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>FLAKE - Sistema de Gestión Escolar</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container mt-5">
        <!-- Login Section -->
        <div id="login-section">
            <h2>Iniciar Sesión</h2>
            <form id="login-form">
                <div class="mb-3">
                    <label for="identificacion" class="form-label">Identificación</label>
                    <input type="text" class="form-control" id="identificacion" required>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Contraseña</label>
                    <input type="password" class="form-control" id="password" required>
                </div>
                <button type="submit" class="btn btn-primary">Ingresar</button>
            </form>
            <div id="login-error" class="text-danger mt-3"></div>
        </div>

        <!-- Main Application Section -->
        <div id="app-section" class="hidden">
            <h2>Bienvenido al Sistema FLAKE</h2>
            <button id="logout-btn" class="btn btn-secondary mb-3">Cerrar Sesión</button>

            <!-- Nav Tabs -->
            <ul class="nav nav-tabs" id="appTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="usuarios-tab" data-bs-toggle="tab" data-bs-target="#usuarios" type="button" role="tab">Usuarios</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="aulas-tab" data-bs-toggle="tab" data-bs-target="#aulas" type="button" role="tab">Aulas</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="estudiantes-tab" data-bs-toggle="tab" data-bs-target="#estudiantes" type="button" role="tab">Estudiantes</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="horarios-tab" data-bs-toggle="tab" data-bs-target="#horarios" type="button" role="tab">Horarios</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="instituciones-tab" data-bs-toggle="tab" data-bs-target="#instituciones" type="button" role="tab">Instituciones</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="reportes-tab" data-bs-toggle="tab" data-bs-target="#reportes" type="button" role="tab">Reportes</button>
                </li>
            </ul>

            <div class="tab-content" id="appTabsContent">
                <!-- Usuarios Tab -->
                <div class="tab-pane fade show active" id="usuarios" role="tabpanel">
                    <h3 class="mt-3">Gestión de Usuarios</h3>
                    <!-- Agregar Usuario -->
                    <form id="agregar-usuario-form" class="mb-4">
                        <h5>Agregar Usuario</h5>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="rol" class="form-label">Rol</label>
                                <select class="form-select" id="rol" required>
                                    <option value="">Seleccione</option>
                                    <option value="Administrador">Administrador</option>
                                    <option value="Tutor">Tutor</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="pwd" class="form-label">Contraseña</label>
                                <input type="password" class="form-control" id="pwd" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="tipo_id" class="form-label">Tipo de ID</label>
                                <input type="text" class="form-control" id="tipo_id" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="identificacion_usuario" class="form-label">Identificación</label>
                                <input type="text" class="form-control" id="identificacion_usuario" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="primer_nombre_usuario" class="form-label">Primer Nombre</label>
                                <input type="text" class="form-control" id="primer_nombre_usuario" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="segundo_nombre_usuario" class="form-label">Segundo Nombre</label>
                                <input type="text" class="form-control" id="segundo_nombre_usuario">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="primer_apellido_usuario" class="form-label">Primer Apellido</label>
                                <input type="text" class="form-control" id="primer_apellido_usuario" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="segundo_apellido_usuario" class="form-label">Segundo Apellido</label>
                                <input type="text" class="form-control" id="segundo_apellido_usuario">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="correo_usuario" class="form-label">Correo Electrónico</label>
                                <input type="email" class="form-control" id="correo_usuario" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="telefono_usuario" class="form-label">Teléfono</label>
                            <input type="text" class="form-control" id="telefono_usuario" required>
                        </div>
                        <button type="submit" class="btn btn-success">Agregar Usuario</button>
                    </form>

                    <!-- Tabla de Usuarios -->
                    <h5>Lista de Usuarios</h5>
                    <table class="table table-bordered" id="usuarios-table">
                        <thead>
                            <tr>
                                <th>ID Usuario</th>
                                <th>Nombre Completo</th>
                                <th>Rol</th>
                                <th>Correo</th>
                                <th>Teléfono</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Datos dinámicos -->
                        </tbody>
                    </table>
                </div>

                <!-- Aulas Tab -->
                <div class="tab-pane fade" id="aulas" role="tabpanel">
                    <h3 class="mt-3">Gestión de Aulas</h3>
                    <!-- Agregar Aula -->
                    <form id="agregar-aula-form" class="mb-4">
                        <h5>Agregar Aula</h5>
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="grado_t" class="form-label">Tipo de Grado</label>
                                <input type="text" class="form-control" id="grado_t" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="grado_num" class="form-label">Número de Grado</label>
                                <input type="number" class="form-control" id="grado_num" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="grupo_equivalente" class="form-label">Grupo Equivalente</label>
                                <input type="text" class="form-control" id="grupo_equivalente" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="jornada" class="form-label">Jornada</label>
                                <input type="text" class="form-control" id="jornada" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="codigo_insti" class="form-label">Código de Institución</label>
                                <input type="text" class="form-control" id="codigo_insti" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="id_usuario_tutor" class="form-label">ID Usuario Tutor</label>
                                <input type="text" class="form-control" id="id_usuario_tutor" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success">Agregar Aula</button>
                    </form>

                    <!-- Tabla de Aulas -->
                    <h5>Lista de Aulas</h5>
                    <table class="table table-bordered" id="aulas-table">
                        <thead>
                            <tr>
                                <th>Grupo</th>
                                <th>Grado T</th>
                                <th>Grado Num</th>
                                <th>Grupo Equivalente</th>
                                <th>Jornada</th>
                                <th>Año</th>
                                <th>Institución</th>
                                <th>Tutor</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Datos dinámicos -->
                        </tbody>
                    </table>
                </div>

                <!-- Estudiantes Tab -->
                <div class="tab-pane fade" id="estudiantes" role="tabpanel">
                    <h3 class="mt-3">Gestión de Estudiantes</h3>
                    <!-- Agregar Estudiante -->
                    <form id="agregar-estudiante-form" class="mb-4">
                        <h5>Agregar Estudiante</h5>
                        <div class="row">
                            <div class="col-md-2 mb-3">
                                <label for="tipo_id_estudiante" class="form-label">Tipo de ID</label>
                                <input type="text" class="form-control" id="tipo_id_estudiante" required>
                            </div>
                            <div class="col-md-2 mb-3">
                                <label for="id_estudiante" class="form-label">ID Estudiante</label>
                                <input type="text" class="form-control" id="id_estudiante" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="primer_nombre_estudiante" class="form-label">Primer Nombre</label>
                                <input type="text" class="form-control" id="primer_nombre_estudiante" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="segundo_nombre_estudiante" class="form-label">Segundo Nombre</label>
                                <input type="text" class="form-control" id="segundo_nombre_estudiante">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="primer_apellido_estudiante" class="form-label">Primer Apellido</label>
                                <input type="text" class="form-control" id="primer_apellido_estudiante" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="segundo_apellido_estudiante" class="form-label">Segundo Apellido</label>
                                <input type="text" class="form-control" id="segundo_apellido_estudiante">
                            </div>
                            <div class="col-md-2 mb-3">
                                <label for="genero_estudiante" class="form-label">Género</label>
                                <select class="form-select" id="genero_estudiante" required>
                                    <option value="">Seleccione</option>
                                    <option value="M">Masculino</option>
                                    <option value="F">Femenino</option>
                                </select>
                            </div>
                            <div class="col-md-2 mb-3">
                                <label for="fecha_nacimiento_estudiante" class="form-label">Fecha Nacimiento</label>
                                <input type="date" class="form-control" id="fecha_nacimiento_estudiante" required>
                            </div>
                            <div class="col-md-2 mb-3">
                                <label for="estrato_estudiante" class="form-label">Estrato</label>
                                <input type="number" class="form-control" id="estrato_estudiante" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-2 mb-3">
                                <label for="anio_estudiante" class="form-label">Año</label>
                                <input type="number" class="form-control" id="anio_estudiante" required>
                            </div>
                            <div class="col-md-2 mb-3">
                                <label for="grupo_estudiante" class="form-label">Grupo</label>
                                <input type="text" class="form-control" id="grupo_estudiante" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success">Agregar Estudiante</button>
                    </form>

                    <!-- Tabla de Estudiantes -->
                    <h5>Lista de Estudiantes</h5>
                    <table class="table table-bordered" id="estudiantes-table">
                        <thead>
                            <tr>
                                <th>ID Estudiante</th>
                                <th>Nombre Completo</th>
                                <th>Género</th>
                                <th>Fecha Nacimiento</th>
                                <th>Estrato</th>
                                <th>Año</th>
                                <th>Grupo</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Datos dinámicos -->
                        </tbody>
                    </table>
                </div>

                <!-- Horarios Tab -->
                <div class="tab-pane fade" id="horarios" role="tabpanel">
                    <h3 class="mt-3">Gestión de Horarios</h3>
                    <!-- Agregar Horario -->
                    <form id="agregar-horario-form" class="mb-4">
                        <h5>Agregar Horario</h5>
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="fecha_inicio" class="form-label">Fecha Inicio</label>
                                <input type="date" class="form-control" id="fecha_inicio" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="fecha_fin" class="form-label">Fecha Fin</label>
                                <input type="date" class="form-control" id="fecha_fin" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="hora_inicio" class="form-label">Hora Inicio</label>
                                <input type="time" class="form-control" id="hora_inicio" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="hora_fin" class="form-label">Hora Fin</label>
                                <input type="time" class="form-control" id="hora_fin" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="dia_inicial" class="form-label">Inicial del Día</label>
                                <input type="text" class="form-control" id="dia_inicial" maxlength="1" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="dia_texto" class="form-label">Nombre del Día</label>
                                <input type="text" class="form-control" id="dia_texto" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success">Agregar Horario</button>
                    </form>

                    <!-- Tabla de Horarios -->
                    <h5>Lista de Horarios</h5>
                    <table class="table table-bordered" id="horarios-table">
                        <thead>
                            <tr>
                                <th>CodigoH</th>
                                <th>Fecha Inicio</th>
                                <th>Fecha Fin</th>
                                <th>Hora Inicio</th>
                                <th>Hora Fin</th>
                                <th>Día Inicial</th>
                                <th>Día Texto</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Datos dinámicos -->
                        </tbody>
                    </table>
                </div>

                <!-- Instituciones Tab -->
                <div class="tab-pane fade" id="instituciones" role="tabpanel">
                    <h3 class="mt-3">Gestión de Instituciones</h3>
                    <!-- Agregar Institución -->
                    <form id="agregar-institucion-form" class="mb-4">
                        <h5>Agregar Institución</h5>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="codigo_insti_insti" class="form-label">Código Institución</label>
                                <input type="text" class="form-control" id="codigo_insti_insti" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="nombre_insti" class="form-label">Nombre Institución</label>
                                <input type="text" class="form-control" id="nombre_insti" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="nombre_rector" class="form-label">Nombre Rector</label>
                                <input type="text" class="form-control" id="nombre_rector" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="localidad" class="form-label">Localidad</label>
                                <input type="text" class="form-control" id="localidad" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="barrio" class="form-label">Barrio</label>
                                <input type="text" class="form-control" id="barrio" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="numero_insti" class="form-label">Número</label>
                                <input type="number" class="form-control" id="numero_insti" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="direccion_insti" class="form-label">Dirección</label>
                                <input type="text" class="form-control" id="direccion_insti" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success">Agregar Institución</button>
                    </form>

                    <!-- Tabla de Instituciones -->
                    <h5>Lista de Instituciones</h5>
                    <table class="table table-bordered" id="instituciones-table">
                        <thead>
                            <tr>
                                <th>Código</th>
                                <th>Nombre</th>
                                <th>Rector</th>
                                <th>Localidad</th>
                                <th>Barrio</th>
                                <th>Número</th>
                                <th>Dirección</th>
                                <th>Año</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Datos dinámicos -->
                        </tbody>
                    </table>
                </div>

                <!-- Reportes Tab -->
                <div class="tab-pane fade" id="reportes" role="tabpanel">
                    <h3 class="mt-3">Generar Reportes</h3>
                    <ul class="list-group">
                        <li class="list-group-item">
                            <h5>Reporte de Aulas</h5>
                            <button class="btn btn-primary" id="generar-reporte-aulas">Generar</button>
                            <pre id="reporte-aulas" class="mt-3"></pre>
                        </li>
                        <li class="list-group-item">
                            <h5>Reporte de Aulas por Tutor</h5>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="id_usuario_reporte_aulas_tutor" class="form-label">ID Usuario Tutor</label>
                                    <input type="text" class="form-control" id="id_usuario_reporte_aulas_tutor" required>
                                </div>
                            </div>
                            <button class="btn btn-primary" id="generar-reporte-aulas-tutor">Generar</button>
                            <pre id="reporte-aulas-tutor" class="mt-3"></pre>
                        </li>
                        <li class="list-group-item">
                            <h5>Reporte de Estudiantes por Aula</h5>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="grupo_reporte_estudiantes" class="form-label">Grupo</label>
                                    <input type="text" class="form-control" id="grupo_reporte_estudiantes" required>
                                </div>
                            </div>
                            <button class="btn btn-primary" id="generar-reporte-estudiantes-aula">Generar</button>
                            <pre id="reporte-estudiantes-aula" class="mt-3"></pre>
                        </li>
                        <li class="list-group-item">
                            <h5>Reporte de Instituciones</h5>
                            <button class="btn btn-primary" id="generar-reporte-instituciones">Generar</button>
                            <pre id="reporte-instituciones" class="mt-3"></pre>
                        </li>
                        <li class="list-group-item">
                            <h5>Reporte de Personas</h5>
                            <button class="btn btn-primary" id="generar-reporte-personas">Generar</button>
                            <pre id="reporte-personas" class="mt-3"></pre>
                        </li>
                        <li class="list-group-item">
                            <h5>Reporte de Tutores</h5>
                            <button class="btn btn-primary" id="generar-reporte-tutores">Generar</button>
                            <pre id="reporte-tutores" class="mt-3"></pre>
                        </li>
                        <li class="list-group-item">
                            <h5>Calificaciones por Aula</h5>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="grupo_calificaciones" class="form-label">Grupo</label>
                                    <input type="text" class="form-control" id="grupo_calificaciones" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="anio_calificaciones" class="form-label">Año</label>
                                    <input type="number" class="form-control" id="anio_calificaciones" required>
                                </div>
                            </div>
                            <button class="btn btn-primary" id="generar-reporte-calificaciones">Generar</button>
                            <pre id="reporte-calificaciones" class="mt-3"></pre>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS y dependencias (Popper.js) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- JavaScript para manejar la lógica de la aplicación -->
    <script>
        const loginSection = document.getElementById('login-section');
        const appSection = document.getElementById('app-section');
        const loginForm = document.getElementById('login-form');
        const loginError = document.getElementById('login-error');
        const logoutBtn = document.getElementById('logout-btn');
        let accessToken = '';

        // Función para mostrar u ocultar secciones
        function showSection(section) {
            if (section === 'login') {
                loginSection.classList.remove('hidden');
                appSection.classList.add('hidden');
            } else {
                loginSection.classList.add('hidden');
                appSection.classList.remove('hidden');
            }
        }

        // Inicialmente, mostrar la sección de login
        showSection('login');

        // Manejar el login
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            loginError.textContent = '';

            const identificacion = document.getElementById('identificacion').value;
            const password = document.getElementById('password').value;

            try {
                const response = await fetch('http://localhost:5000/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ identificacion, password })
                });

                const data = await response.json();

                if (response.ok) {
                    accessToken = data.access_token;
                    showSection('app');
                    cargarUsuarios();
                    cargarAulas();
                    cargarEstudiantes();
                    cargarHorarios();
                    cargarInstituciones();
                } else {
                    loginError.textContent = data.error || data.message;
                }
            } catch (error) {
                loginError.textContent = 'Error de conexión';
            }
        });

        // Manejar el logout
        logoutBtn.addEventListener('click', () => {
            accessToken = '';
            showSection('login');
        });

        // Función para agregar encabezados de autorización
        function getAuthHeaders() {
            return {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${accessToken}`
            };
        }

        // ==================== Usuarios ====================

        const agregarUsuarioForm = document.getElementById('agregar-usuario-form');
        const usuariosTableBody = document.querySelector('#usuarios-table tbody');

        agregarUsuarioForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const rol = document.getElementById('rol').value;
            const pwd = document.getElementById('pwd').value;
            const tipo_id = document.getElementById('tipo_id').value;
            const identificacion = document.getElementById('identificacion_usuario').value;
            const primer_nombre = document.getElementById('primer_nombre_usuario').value;
            const segundo_nombre = document.getElementById('segundo_nombre_usuario').value;
            const primer_apellido = document.getElementById('primer_apellido_usuario').value;
            const segundo_apellido = document.getElementById('segundo_apellido_usuario').value;
            const correo = document.getElementById('correo_usuario').value;
            const telefono = document.getElementById('telefono_usuario').value;

            try {
                const response = await fetch('http://localhost:5000/usuarios', {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({
                        rol, pwd, tipo_id, identificacion,
                        primer_nombre, segundo_nombre, primer_apellido,
                        segundo_apellido, correo, telefono
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    alert(data.message);
                    agregarUsuarioForm.reset();
                    cargarUsuarios();
                } else {
                    alert(data.error || data.message);
                }
            } catch (error) {
                alert('Error de conexión');
            }
        });

        async function cargarUsuarios() {
            try {
                const response = await fetch('http://localhost:5000/reportes/usuarios', {
                    method: 'GET',
                    headers: getAuthHeaders()
                });

                const data = await response.json();

                if (response.ok) {
                    usuariosTableBody.innerHTML = '';
                    data.reporte.forEach(usuario => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${usuario.id_usuario}</td>
                            <td>${usuario.nombre_completo}</td>
                            <td>${usuario.rol}</td>
                            <td>${usuario.correo}</td>
                            <td>${usuario.telefono}</td>
                            <td>
                                <!-- Aquí puedes agregar botones para editar o eliminar -->
                            </td>
                        `;
                        usuariosTableBody.appendChild(row);
                    });
                } else {
                    usuariosTableBody.innerHTML = `<tr><td colspan="6">${data.message}</td></tr>`;
                }
            } catch (error) {
                usuariosTableBody.innerHTML = `<tr><td colspan="6">Error de conexión</td></tr>`;
            }
        }

        // ==================== Aulas ====================

        const agregarAulaForm = document.getElementById('agregar-aula-form');
        const aulasTableBody = document.querySelector('#aulas-table tbody');

        agregarAulaForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const grado_t = document.getElementById('grado_t').value;
            const grado_num = document.getElementById('grado_num').value;
            const grupo_equivalente = document.getElementById('grupo_equivalente').value;
            const jornada = document.getElementById('jornada').value;
            const codigo_insti = document.getElementById('codigo_insti').value;
            const id_usuario = document.getElementById('id_usuario_tutor').value;

            try {
                const response = await fetch('http://localhost:5000/aulas', {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({
                        grado_t, grado_num, grupo_equivalente, jornada, codigo_insti, id_usuario
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    alert(data.message);
                    agregarAulaForm.reset();
                    cargarAulas();
                } else {
                    alert(data.error || data.message);
                }
            } catch (error) {
                alert('Error de conexión');
            }
        });

        async function cargarAulas() {
            try {
                const response = await fetch('http://localhost:5000/reportes/aulas', {
                    method: 'GET',
                    headers: getAuthHeaders()
                });

                const data = await response.json();

                if (response.ok) {
                    aulasTableBody.innerHTML = '';
                    data.reporte.forEach(aula => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${aula.grupo}</td>
                            <td>${aula.grado_t}</td>
                            <td>${aula.grado_num}</td>
                            <td>${aula.grupo_equivalente}</td>
                            <td>${aula.jornada}</td>
                            <td>${aula.anio}</td>
                            <td>${aula.institucion}</td>
                            <td>${aula.tutor}</td>
                            <td>
                                <!-- Aquí puedes agregar botones para editar o eliminar -->
                            </td>
                        `;
                        aulasTableBody.appendChild(row);
                    });
                } else {
                    aulasTableBody.innerHTML = `<tr><td colspan="9">${data.message}</td></tr>`;
                }
            } catch (error) {
                aulasTableBody.innerHTML = `<tr><td colspan="9">Error de conexión</td></tr>`;
            }
        }

        // ==================== Estudiantes ====================

        const agregarEstudianteForm = document.getElementById('agregar-estudiante-form');
        const estudiantesTableBody = document.querySelector('#estudiantes-table tbody');

        agregarEstudianteForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const tipo_id = document.getElementById('tipo_id_estudiante').value;
            const id_estudiante = document.getElementById('id_estudiante').value;
            const primer_nombre = document.getElementById('primer_nombre_estudiante').value;
            const segundo_nombre = document.getElementById('segundo_nombre_estudiante').value;
            const primer_apellido = document.getElementById('primer_apellido_estudiante').value;
            const segundo_apellido = document.getElementById('segundo_apellido_estudiante').value;
            const genero = document.getElementById('genero_estudiante').value;
            const fecha_nacimiento = document.getElementById('fecha_nacimiento_estudiante').value;
            const estrato = document.getElementById('estrato_estudiante').value;
            const anio = document.getElementById('anio_estudiante').value;
            const grupo = document.getElementById('grupo_estudiante').value;

            try {
                const response = await fetch('http://localhost:5000/estudiantes', {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({
                        tipo_id, id_estudiante, primer_nombre, segundo_nombre,
                        primer_apellido, segundo_apellido, genero, fecha_nacimiento,
                        estrato, anio, grupo
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    alert(data.message);
                    agregarEstudianteForm.reset();
                    cargarEstudiantes();
                } else {
                    alert(data.error || data.message);
                }
            } catch (error) {
                alert('Error de conexión');
            }
        });

        async function cargarEstudiantes() {
            try {
                const response = await fetch('http://localhost:5000/reportes/estudiantes_aula?grupo=', {
                    method: 'GET',
                    headers: getAuthHeaders()
                });

                // Implementa una manera de seleccionar el grupo para mostrar los estudiantes

                // Por simplicidad, omitimos la carga automática
                estudiantesTableBody.innerHTML = `<tr><td colspan="8">Seleccione un grupo para ver los estudiantes.</td></tr>`;
            } catch (error) {
                estudiantesTableBody.innerHTML = `<tr><td colspan="8">Error de conexión</td></tr>`;
            }
        }

        // ==================== Horarios ====================

        const agregarHorarioForm = document.getElementById('agregar-horario-form');
        const horariosTableBody = document.querySelector('#horarios-table tbody');

        agregarHorarioForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const fecha_inicio = document.getElementById('fecha_inicio').value;
            const fecha_fin = document.getElementById('fecha_fin').value;
            const hora_inicio = document.getElementById('hora_inicio').value;
            const hora_fin = document.getElementById('hora_fin').value;
            const dia_inicial = document.getElementById('dia_inicial').value;
            const dia_texto = document.getElementById('dia_texto').value;

            try {
                const response = await fetch('http://localhost:5000/horarios', {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({
                        fecha_inicio, fecha_fin, hora_inicio, hora_fin, dia_inicial, dia_texto
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    alert(data.message);
                    agregarHorarioForm.reset();
                    cargarHorarios();
                } else {
                    alert(data.error || data.message);
                }
            } catch (error) {
                alert('Error de conexión');
            }
        });

        async function cargarHorarios() {
            try {
                const response = await fetch('http://localhost:5000/reportes/horarios', {
                    method: 'GET',
                    headers: getAuthHeaders()
                });

                // Implementa una ruta para obtener horarios si no existe

                // Por simplicidad, omitimos la carga automática
                horariosTableBody.innerHTML = `<tr><td colspan="8">Funcionalidad pendiente.</td></tr>`;
            } catch (error) {
                horariosTableBody.innerHTML = `<tr><td colspan="8">Error de conexión</td></tr>`;
            }
        }

        // ==================== Instituciones ====================

        const agregarInstitucionForm = document.getElementById('agregar-institucion-form');
        const institucionesTableBody = document.querySelector('#instituciones-table tbody');

        agregarInstitucionForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const codigo_insti = document.getElementById('codigo_insti_insti').value;
            const nombre_insti = document.getElementById('nombre_insti').value;
            const nombre_rector = document.getElementById('nombre_rector').value;
            const localidad = document.getElementById('localidad').value;
            const barrio = document.getElementById('barrio').value;
            const numero = document.getElementById('numero_insti').value;
            const direccion = document.getElementById('direccion_insti').value;

            try {
                const response = await fetch('http://localhost:5000/instituciones', {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({
                        codigo_insti, nombre_insti, nombre_rector,
                        localidad, barrio, numero, direccion
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    alert(data.message);
                    agregarInstitucionForm.reset();
                    cargarInstituciones();
                } else {
                    alert(data.error || data.message);
                }
            } catch (error) {
                alert('Error de conexión');
            }
        });

        async function cargarInstituciones() {
            try {
                const response = await fetch('http://localhost:5000/reportes/instituciones', {
                    method: 'GET',
                    headers: getAuthHeaders()
                });

                const data = await response.json();

                if (response.ok) {
                    institucionesTableBody.innerHTML = '';
                    data.reporte.forEach(insti => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${insti.codigo}</td>
                            <td>${insti.nombre}</td>
                            <td>${insti.rector}</td>
                            <td>${insti.localidad}</td>
                            <td>${insti.barrio}</td>
                            <td>${insti.numero}</td>
                            <td>${insti.direccion}</td>
                            <td>${insti.anio}</td>
                            <td>
                                <!-- Aquí puedes agregar botones para editar o eliminar -->
                            </td>
                        `;
                        institucionesTableBody.appendChild(row);
                    });
                } else {
                    institucionesTableBody.innerHTML = `<tr><td colspan="9">${data.message}</td></tr>`;
                }
            } catch (error) {
                institucionesTableBody.innerHTML = `<tr><td colspan="9">Error de conexión</td></tr>`;
            }
        }

        // ==================== Reportes ====================

        const generarReporteAulasBtn = document.getElementById('generar-reporte-aulas');
        const reporteAulasPre = document.getElementById('reporte-aulas');

        generarReporteAulasBtn.addEventListener('click', async () => {
            try {
                const response = await fetch('http://localhost:5000/reportes/aulas', {
                    method: 'GET',
                    headers: getAuthHeaders()
                });

                const data = await response.json();

                if (response.ok) {
                    reporteAulasPre.textContent = JSON.stringify(data.reporte, null, 2);
                } else {
                    reporteAulasPre.textContent = data.message;
                }
            } catch (error) {
                reporteAulasPre.textContent = 'Error de conexión';
            }
        });

        const generarReporteAulasTutorBtn = document.getElementById('generar-reporte-aulas-tutor');
        const reporteAulasTutorPre = document.getElementById('reporte-aulas-tutor');
        const idUsuarioReporteAulasTutor = document.getElementById('id_usuario_reporte_aulas_tutor');

        generarReporteAulasTutorBtn.addEventListener('click', async () => {
            const id_usuario = idUsuarioReporteAulasTutor.value.trim();
            if (!id_usuario) {
                alert('Ingrese el ID Usuario del tutor');
                return;
            }

            try {
                const response = await fetch(`http://localhost:5000/reportes/aulas_tutor?id_usuario=${id_usuario}`, {
                    method: 'GET',
                    headers: getAuthHeaders()
                });

                const data = await response.json();

                if (response.ok) {
                    reporteAulasTutorPre.textContent = JSON.stringify(data.reporte, null, 2);
                } else {
                    reporteAulasTutorPre.textContent = data.message;
                }
            } catch (error) {
                reporteAulasTutorPre.textContent = 'Error de conexión';
            }
        });

        const generarReporteEstudiantesAulaBtn = document.getElementById('generar-reporte-estudiantes-aula');
        const reporteEstudiantesAulaPre = document.getElementById('reporte-estudiantes-aula');
        const grupoReporteEstudiantes = document.getElementById('grupo_reporte_estudiantes');

        generarReporteEstudiantesAulaBtn.addEventListener('click', async () => {
            const grupo = grupoReporteEstudiantes.value.trim();
            if (!grupo) {
                alert('Ingrese el grupo del aula');
                return;
            }

            try {
                const response = await fetch(`http://localhost:5000/reportes/estudiantes_aula?grupo=${grupo}`, {
                    method: 'GET',
                    headers: getAuthHeaders()
                });

                const data = await response.json();

                if (response.ok) {
                    reporteEstudiantesAulaPre.textContent = JSON.stringify(data.reporte, null, 2);
                } else {
                    reporteEstudiantesAulaPre.textContent = data.message;
                }
            } catch (error) {
                reporteEstudiantesAulaPre.textContent = 'Error de conexión';
            }
        });

        const generarReporteInstitucionesBtn = document.getElementById('generar-reporte-instituciones');
        const reporteInstitucionesPre = document.getElementById('reporte-instituciones');

        generarReporteInstitucionesBtn.addEventListener('click', async () => {
            try {
                const response = await fetch('http://localhost:5000/reportes/instituciones', {
                    method: 'GET',
                    headers: getAuthHeaders()
                });

                const data = await response.json();

                if (response.ok) {
                    reporteInstitucionesPre.textContent = JSON.stringify(data.reporte, null, 2);
                } else {
                    reporteInstitucionesPre.textContent = data.message;
                }
            } catch (error) {
                reporteInstitucionesPre.textContent = 'Error de conexión';
            }
        });

        const generarReportePersonasBtn = document.getElementById('generar-reporte-personas');
        const reportePersonasPre = document.getElementById('reporte-personas');

        generarReportePersonasBtn.addEventListener('click', async () => {
            try {
                const response = await fetch('http://localhost:5000/reportes/personas', {
                    method: 'GET',
                    headers: getAuthHeaders()
                });

                const data = await response.json();

                if (response.ok) {
                    reportePersonasPre.textContent = JSON.stringify(data.reporte, null, 2);
                } else {
                    reportePersonasPre.textContent = data.message;
                }
            } catch (error) {
                reportePersonasPre.textContent = 'Error de conexión';
            }
        });

        const generarReporteTutoresBtn = document.getElementById('generar-reporte-tutores');
        const reporteTutoresPre = document.getElementById('reporte-tutores');

        generarReporteTutoresBtn.addEventListener('click', async () => {
            try {
                const response = await fetch('http://localhost:5000/reportes/tutores', {
                    method: 'GET',
                    headers: getAuthHeaders()
                });

                const data = await response.json();

                if (response.ok) {
                    reporteTutoresPre.textContent = JSON.stringify(data.reporte, null, 2);
                } else {
                    reporteTutoresPre.textContent = data.message;
                }
            } catch (error) {
                reporteTutoresPre.textContent = 'Error de conexión';
            }
        });

        const generarReporteCalificacionesBtn = document.getElementById('generar-reporte-calificaciones');
        const reporteCalificacionesPre = document.getElementById('reporte-calificaciones');
        const grupoCalificaciones = document.getElementById('grupo_calificaciones');
        const anioCalificaciones = document.getElementById('anio_calificaciones');

        generarReporteCalificacionesBtn.addEventListener('click', async () => {
            const grupo = grupoCalificaciones.value.trim();
            const anio = anioCalificaciones.value.trim();

            if (!grupo || !anio) {
                alert('Ingrese el grupo y el año');
                return;
            }

            try {
                const response = await fetch(`http://localhost:5000/reportes/calificaciones_aula?grupo=${grupo}&anio=${anio}`, {
                    method: 'GET',
                    headers: getAuthHeaders()
                });

                const data = await response.json();

                if (response.ok) {
                    reporteCalificacionesPre.textContent = JSON.stringify(data.reporte, null, 2);
                } else {
                    reporteCalificacionesPre.textContent = data.message;
                }
            } catch (error) {
                reporteCalificacionesPre.textContent = 'Error de conexión';
            }
        });

        // ==================== Funciones Generales ====================

        // Puedes agregar aquí más funciones para manejar otras secciones como reportes de horarios, etc.

    </script>
</body>
</html>

