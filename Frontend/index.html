<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLAKE - Gestión Académica</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <!-- Sección de Inicio de Sesión -->
        <div id="login-section">
            <h2>Inicio de Sesión</h2>
            <form id="login-form">
                <div class="mb-3">
                    <label for="identificacion" class="form-label">Identificación</label>
                    <input type="text" class="form-control" id="identificacion" required>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Contraseña</label>
                    <input type="password" class="form-control" id="password" required>
                </div>
                <button type="submit" class="btn btn-primary">Iniciar Sesión</button>
            </form>
        </div>

        <!-- <!DOCTYPE html> -->
<!-- <html lang="en"> -->
<!-- <head> -->
<!--     <meta charset="UTF-8"> -->
<!--     <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
<!--     <title>FLAKE - Panel del Tutor</title> -->
<!--     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"> -->
<!--     <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script> -->
<!-- </head> -->
<!-- <body> -->
<!--     <!-- PANEL DEL TUTOR --> -->
<!--     <div id="tutor-panel" class="container mt-4"> -->
<!--         <h2>Panel del Tutor</h2> -->
<!--         <div> -->
<!--             <button class="btn btn-secondary mb-3" onclick="loadTutorSection('attendance')">Registrar Asistencia</button> -->
<!--             <button class="btn btn-secondary mb-3" onclick="loadTutorSection('grades')">Gestión de Calificaciones</button> -->
<!--             <button class="btn btn-secondary mb-3" onclick="loadTutorSection('reports')">Reportes</button> -->
<!--             <button class="btn btn-danger mb-3" onclick="logout()">Cerrar Sesión</button> -->
<!--         </div> -->
<!--         <div id="tutor-content" class="mt-4"></div> -->
<!--     </div> -->

<!--     <script> -->
<!--         const apiUrl = 'http://127.0.0.1:5000'; // Cambiar según configuración del servidor -->

<!--         // Cargar secciones dinámicas del tutor -->
<!--         async function loadTutorSection(section) { -->
<!--             const content = document.getElementById('tutor-content'); -->
<!--             content.innerHTML = `<h3>Cargando ${section}...</h3>`; -->

<!--             try { -->
<!--                 if (section === 'attendance') { -->
<!--                     await loadAttendance(content); -->
<!--                 } else if (section === 'grades') { -->
<!--                     await loadGrades(content); -->
<!--                 } else if (section === 'reports') { -->
<!--                     await loadTutorReport(content); -->
<!--                 } -->
<!--             } catch (error) { -->
<!--                 content.innerHTML = `<p>Error al cargar la sección: ${error.response?.data?.error || error.message}</p>`; -->
<!--             } -->
<!--         } -->

<!--         // Cargar reporte de asistencia del tutor -->
<!--         async function loadAttendance(content) { -->
<!--             content.innerHTML = '<h3>Cargando asistencias...</h3>'; -->
<!--             try { -->
<!--                 const response = await axios.get(`${apiUrl}/reporte-asistencia`); -->
<!--                 const asistencias = response.data.reporte; -->
                
<!--                 let table = '<table class="table table-striped">'; -->
<!--                 table += '<thead><tr><th>Fecha</th><th>Grupo</th><th>Asistencia</th></tr></thead><tbody>'; -->
<!--                 asistencias.forEach(asistencia => { -->
<!--                     table += ` -->
<!--                         <tr> -->
<!--                             <td>${asistencia.fecha}</td> -->
<!--                             <td>${asistencia.grupo}</td> -->
<!--                             <td>${asistencia.estado}</td> -->
<!--                         </tr>`; -->
<!--                 }); -->
<!--                 table += '</tbody></table>'; -->
<!--                 content.innerHTML = table; -->
<!--             } catch (error) { -->
<!--                 content.innerHTML = '<p>Error al cargar las asistencias.</p>'; -->
<!--             } -->
<!--         } -->

<!--         // Cargar gestión de calificaciones -->
<!--         async function loadGrades(content) { -->
<!--             content.innerHTML = '<h3>Cargando calificaciones...</h3>'; -->
<!--             try { -->
<!--                 const response = await axios.get(`${apiUrl}/reporte-calificaciones`); -->
<!--                 const calificaciones = response.data.reporte; -->
                
<!--                 let table = '<table class="table table-striped">'; -->
<!--                 table += '<thead><tr><th>Estudiante</th><th>Materia</th><th>Calificación</th></tr></thead><tbody>'; -->
<!--                 calificaciones.forEach(calificacion => { -->
<!--                     table += ` -->
<!--                         <tr> -->
<!--                             <td>${calificacion.estudiante}</td> -->
<!--                             <td>${calificacion.materia}</td> -->
<!--                             <td>${calificacion.nota}</td> -->
<!--                         </tr>`; -->
<!--                 }); -->
<!--                 table += '</tbody></table>'; -->
<!--                 content.innerHTML = table; -->
<!--             } catch (error) { -->
<!--                 content.innerHTML = '<p>Error al cargar las calificaciones.</p>'; -->
<!--             } -->
<!--         } -->

<!--         // Cargar reporte general del tutor -->
<!--         async function loadTutorReport(content) { -->
<!--             content.innerHTML = '<h3>Cargando reporte...</h3>'; -->
<!--             try { -->
<!--                 const response = await axios.get(`${apiUrl}/reporte-tutores`); -->
<!--                 const reportes = response.data.reporte; -->
                
<!--                 let table = '<table class="table table-striped">'; -->
<!--                 table += '<thead><tr><th>ID</th><th>Nombre</th><th>Correo</th><th>Teléfono</th></tr></thead><tbody>'; -->
<!--                 reportes.forEach(reporte => { -->
<!--                     table += ` -->
<!--                         <tr> -->
<!--                             <td>${reporte.id_usuario}</td> -->
<!--                             <td>${reporte.nombre} ${reporte.apellido}</td> -->
<!--                             <td>${reporte.correo}</td> -->
<!--                             <td>${reporte.telefono}</td> -->
<!--                         </tr>`; -->
<!--                 }); -->
<!--                 table += '</tbody></table>'; -->
<!--                 content.innerHTML = table; -->
<!--             } catch (error) { -->
<!--                 content.innerHTML = '<p>Error al cargar el reporte del tutor.</p>'; -->
<!--             } -->
<!--         } -->

<!--         // Función para cerrar sesión -->
<!--         function logout() { -->
<!--             alert('Sesión cerrada exitosamente'); -->
<!--             window.location.reload(); -->
<!--         } -->
<!--     </script> -->
<!-- </body> -->
<!-- </html> -->

    
        <!-- Panel de Administración -->
        <div id="admin-panel" class="hidden">
            <h2>Panel de Administración</h2>
            <div>
                <button class="btn btn-secondary" onclick="loadAdminSection('users')">Gestión de Usuarios</button>
                <button class="btn btn-secondary" onclick="loadAdminSection('roles')">Gestión de Roles</button>
                <button class="btn btn-secondary" onclick="loadAdminSection('institutions')">Gestión de Instituciones</button>
                <button class="btn btn-secondary" onclick="loadAdminSection('classes')">Gestión de Aulas</button>
                <button class="btn btn-secondary" onclick="loadAdminSection('students')">Gestión de Estudiantes</button>
                <button class="btn btn-secondary" onclick="loadAdminSection('schedules')">Gestión de Horarios</button>
                <button class="btn btn-secondary" onclick="loadAdminSection('grades')">Gestión de Calificaciones</button>
                <button class="btn btn-secondary" onclick="loadAdminSection('attendance')">Gestión de Asistencias</button>
                <button class="btn btn-secondary" onclick="loadAdminSection('reports')">Reportes</button>
                <button class="btn btn-danger" onclick="logout()">Cerrar Sesión</button>
            </div>
            <div id="admin-content" class="mt-4"></div>
        </div>
    
        <!-- Panel del Tutor -->
        <div id="tutor-panel" class="hidden">
            <h2>Panel del Tutor</h2>
            <div>
                <button class="btn btn-secondary" onclick="loadTutorSection('attendance')">Registrar Asistencia</button>
                <button class="btn btn-secondary" onclick="loadTutorSection('grades')">Gestión de Calificaciones</button>
                <button class="btn btn-secondary" onclick="loadTutorSection('reports')">Reportes</button>
                <button class="btn btn-danger" onclick="logout()">Cerrar Sesión</button>
            </div>
            <div id="tutor-content" class="mt-4"></div>
        </div>
    
        <!-- Secciones específicas de Administración -->
        <!-- Gestión de Roles -->
        <div id="roles-section" class="hidden">
            <h3>Gestión de Roles</h3>
            <button class="btn btn-success mb-3" onclick="showAddRoleForm()">Agregar Rol</button>
            <div id="roles-list"></div>
            <div id="roles-form" class="hidden">
                <h4>Formulario de Rol</h4>
                <form id="role-form">
                    <input type="hidden" id="role-id">
                    <div class="mb-3">
                        <label for="role-name" class="form-label">Nombre del Rol</label>
                        <input type="text" class="form-control" id="role-name" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                    <button type="button" class="btn btn-secondary" onclick="hideAddRoleForm()">Cancelar</button>
                </form>
            </div>
        </div>
    
        <!-- Gestión de Instituciones -->
        <div id="institutions-section" class="hidden">
            <h3>Gestión de Instituciones</h3>
            <button class="btn btn-success mb-3" onclick="showAddInstitutionForm()">Agregar Institución</button>
            <div id="institutions-list"></div>
            <div id="institutions-form" class="hidden">
                <h4>Formulario de Institución</h4>
                <form id="institution-form">
                    <input type="hidden" id="institution-id">
                    <div class="mb-3">
                        <label for="codigo-insti" class="form-label">Código</label>
                        <input type="text" class="form-control" id="codigo-insti" required>
                    </div>
                    <div class="mb-3">
                        <label for="nombre-insti" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="nombre-insti" required>
                    </div>
                    <div class="mb-3">
                        <label for="nombre-rector" class="form-label">Nombre del Rector</label>
                        <input type="text" class="form-control" id="nombre-rector" required>
                    </div>
                    <div class="mb-3">
                        <label for="localidad" class="form-label">Localidad</label>
                        <input type="text" class="form-control" id="localidad" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                    <button type="button" class="btn btn-secondary" onclick="hideAddInstitutionForm()">Cancelar</button>
                </form>
            </div>
        </div>
    
        <!-- Gestión de Aulas -->
        <div id="aulas-section" class="hidden">
            <h3>Gestión de Aulas</h3>
            <button class="btn btn-success mb-3" onclick="showAddAulaForm()">Agregar Aula</button>
            <div id="aulas-list"></div>
            <div id="aulas-form" class="hidden">
                <h4>Formulario de Aula</h4>
                <form id="aula-form">
                    <input type="hidden" id="aula-grupo">
                    <div class="mb-3">
                        <label for="grado-t" class="form-label">Grado (Texto)</label>
                        <input type="text" class="form-control" id="grado-t" required>
                    </div>
                    <div class="mb-3">
                        <label for="grado-num" class="form-label">Grado (Número)</label>
                        <input type="number" class="form-control" id="grado-num" required>
                    </div>
                    <div class="mb-3">
                        <label for="grupo-equiv" class="form-label">Grupo Equivalente</label>
                        <input type="text" class="form-control" id="grupo-equiv">
                    </div>
                    <div class="mb-3">
                        <label for="jornada" class="form-label">Jornada</label>
                        <input type="text" class="form-control" id="jornada" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                    <button type="button" class="btn btn-secondary" onclick="hideAddAulaForm()">Cancelar</button>
                </form>
            </div>
        </div>
    
        <!-- Gestión de Estudiantes -->
        <div id="estudiantes-section" class="hidden">
            <h3>Gestión de Estudiantes</h3>
            <button class="btn btn-success mb-3" onclick="showAddStudentForm()">Agregar Estudiante</button>
            <div id="estudiantes-list"></div>
            <div id="estudiantes-form" class="hidden">
                <h4>Formulario de Estudiante</h4>
                <form id="student-form">
                    <input type="hidden" id="student-id">
                    <div class="mb-3">
                        <label for="tipo-id" class="form-label">Tipo de Identificación</label>
                        <select id="tipo-id" class="form-select" required>
                            <option value="TI">TI</option>
                            <option value="CC">CC</option>
                            <option value="RC">RC</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="id-estudiante" class="form-label">Número de Identificación</label>
                        <input type="text" class="form-control" id="id-estudiante" required>
                    </div>
                    <div class="mb-3">
                        <label for="primer-nombre" class="form-label">Primer Nombre</label>
                        <input type="text" class="form-control" id="primer-nombre" required>
                    </div>
                    <div class="mb-3">
                        <label for="primer-apellido" class="form-label">Primer Apellido</label>
                        <input type="text" class="form-control" id="primer-apellido" required>
                    </div>
                    <div class="mb-3">
                        <label for="grupo" class="form-label">Grupo</label>
                        <input type="number" class="form-control" id="grupo" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                    <button type="button" class="btn btn-secondary" onclick="hideAddStudentForm()">Cancelar</button>
                </form>
            </div>
        </div>
    
        <!-- Gestión de Horarios -->
        <div id="horarios-section" class="hidden">
            <h3>Gestión de Horarios</h3>
            <button class="btn btn-success mb-3" onclick="showAddScheduleForm()">Agregar Horario</button>
            <div id="horarios-list"></div>
            <div id="horarios-form" class="hidden">
                <h4>Formulario de Horario</h4>
                <form id="schedule-form">
                    <div class="mb-3">
                        <label for="hora-inicio" class="form-label">Hora Inicio</label>
                        <input type="time" class="form-control" id="hora-inicio" required>
                    </div>
                    <div class="mb-3">
                        <label for="hora-fin" class="form-label">Hora Fin</label>
                        <input type="time" class="form-control" id="hora-fin" required>
                    </div>
                    <div class="mb-3">
                        <label for="dia-texto" class="form-label">Día de la Semana</label>
                        <input type="text" class="form-control" id="dia-texto" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                    <button type="button" class="btn btn-secondary" onclick="hideAddScheduleForm()">Cancelar</button>
                </form>
            </div>
        </div>
    
        <!-- Gestión de Calificaciones -->
        <div id="calificaciones-section" class="hidden">
            <h3>Gestión de Calificaciones</h3>
            <button class="btn btn-success mb-3" onclick="showAddGradeForm()">Registrar Calificación</button>
            <div id="calificaciones-list"></div>
            <div id="calificaciones-form" class="hidden">
                <h4>Formulario de Calificación</h4>
                <form id="grade-form">
                    <div class="mb-3">
                        <label for="id-estudiante" class="form-label">ID del Estudiante</label>
                        <input type="text" class="form-control" id="id-estudiante" required>
                    </div>
                    <div class="mb-3">
                        <label for="bloque-lectivo" class="form-label">Bloque Lectivo</label>
                        <select id="bloque-lectivo" class="form-select" required>
                            <option value="1">Bloque 1</option>
                            <option value="2">Bloque 2</option>
                            <option value="3">Bloque 3</option>
                            <option value="4">Bloque 4</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="nota" class="form-label">Nota</label>
                        <input type="number" class="form-control" id="nota" min="0" max="5" step="0.1" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                    <button type="button" class="btn btn-secondary" onclick="hideAddGradeForm()">Cancelar</button>
                </form>
            </div>
        </div>
    
        <!-- Gestión de Asistencias -->
        <div id="attendance-section" class="hidden">
            <h3>Gestión de Asistencias</h3>
            <button class="btn btn-success mb-3" onclick="showAddAttendanceForm()">Registrar Asistencia</button>
            <div id="attendance-list"></div>
            <div id="attendance-form" class="hidden">
                <h4>Registrar Asistencia</h4>
                <form id="attendance-form">
                    <div class="mb-3">
                        <label for="attendance-group" class="form-label">Grupo</label>
                        <input type="number" class="form-control" id="attendance-group" required>
                    </div>
                    <div class="mb-3">
                        <label for="attendance-date" class="form-label">Fecha</label>
                        <input type="date" class="form-control" id="attendance-date" required>
                    </div>
                    <div class="mb-3">
                        <label for="attendance-tutor" class="form-label">ID Tutor</label>
                        <input type="text" class="form-control" id="attendance-tutor" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                    <button type="button" class="btn btn-secondary" onclick="hideAddAttendanceForm()">Cancelar</button>
                </form>
            </div>
        </div>
    
        <!-- Reportes -->
        <div id="reportes-section" class="hidden">
            <h3>Reportes</h3>
            <button class="btn btn-info mb-3" onclick="loadReport('aulas')">Reporte de Aulas</button>
            <button class="btn btn-info mb-3" onclick="loadReport('asistencia-estudiantes')">Asistencia de Estudiantes</button>
            <button class="btn btn-info mb-3" onclick="loadReport('asistencia-tutores')">Asistencia de Tutores</button>
            <div id="reportes-content"></div>
        </div>
    </div>
    




    <script>

        const apiUrl = 'http://127.0.0.1:5000'; // Cambiar según configuración del servidor


        async function loadReport(type) {
            const content = document.getElementById('reportes-content');
            content.innerHTML = '<h3>Cargando reporte...</h3>';
        
            try {
                let endpoint = '';
                let params = {};
        
                if (type === 'aulas') {
                    endpoint = `${apiUrl}/generar_reporte_aulas`;
                } else if (type === 'asistencia-estudiantes') {
                    endpoint = `${apiUrl}/asistencias-aula`;
                    params = { grupo: 1 }; // Reemplazar con datos reales
                } else if (type === 'asistencia-tutores') {
                    endpoint = `${apiUrl}/asistencias-usuarios`;
                    params = { grupo: 1 }; // Reemplazar con datos reales
                }
        
                const response = await axios.get(endpoint, { params });
                const reporte = response.data.reporte;
        
                let table = '<table class="table">';
                if (type === 'aulas') {
                    table += '<thead><tr><th>Grupo</th><th>Grado</th><th>Institución</th><th>Tutor</th></tr></thead><tbody>';
                    reporte.forEach(aula => {
                        table += `
                            <tr>
                                <td>${aula.grupo}</td>
                                <td>${aula.grado_t} (${aula.grado_num})</td>
                                <td>${aula.institucion}</td>
                                <td>${aula.tutor}</td>
                            </tr>`;
                    });
                } else if (type === 'asistencia-estudiantes' || type === 'asistencia-tutores') {
                    table += '<thead><tr><th>Fecha</th><th>Nombre</th><th>Día</th><th>Hora Inicio</th><th>Asistencia</th></tr></thead><tbody>';
                    reporte.forEach(asistencia => {
                        table += `
                            <tr>
                                <td>${asistencia.fecha}</td>
                                <td>${asistencia.estudiante || asistencia.usuario}</td>
                                <td>${asistencia.dia}</td>
                                <td>${asistencia.hora_inicio}</td>
                                <td>${asistencia.asistio}</td>
                            </tr>`;
                    });
                }
                table += '</tbody></table>';
                content.innerHTML = table;
            } catch (error) {
                content.innerHTML = '<p>Error al cargar el reporte.</p>';
            }
        }
        

        async function loadGrades(content) {
            content.innerHTML = '<h3>Cargando calificaciones...</h3>';
            try {
                const response = await axios.get(`${apiUrl}/calificaciones-aula`, {
                    params: { grupo: 1, anio: new Date().getFullYear() } // Reemplazar con datos reales
                });
                const calificaciones = response.data.reporte;
        
                let table = '<table class="table">';
                table += '<thead><tr><th>ID Estudiante</th><th>Nombre</th><th>Bloque</th><th>Nota</th></tr></thead><tbody>';
                calificaciones.forEach(calificacion => {
                    table += `
                        <tr>
                            <td>${calificacion.id_estudiante}</td>
                            <td>${calificacion.nombre}</td>
                            <td>${calificacion.bloque_lectivo}</td>
                            <td>${calificacion.nota}</td>
                        </tr>`;
                });
                table += '</tbody></table>';
                content.innerHTML = table;
            } catch (error) {
                content.innerHTML = '<p>Error al cargar calificaciones.</p>';
            }
        }
        
        function showAddGradeForm() {
            document.getElementById('calificaciones-form').classList.remove('hidden');
            document.getElementById('calificaciones-list').classList.add('hidden');
        }
        
        function hideAddGradeForm() {
            document.getElementById('calificaciones-form').classList.add('hidden');
            document.getElementById('calificaciones-list').classList.remove('hidden');
            document.getElementById('grade-form').reset();
        }
        
        async function addGrade(event) {
            event.preventDefault();
            const data = {
                id_estudiante: document.getElementById('id-estudiante').value,
                bloque_lectivo: document.getElementById('bloque-lectivo').value,
                nota: document.getElementById('nota').value
            };
        
            try {
                await axios.post(`${apiUrl}/calificar-estudiante`, data);
                alert('Calificación registrada exitosamente');
                hideAddGradeForm();
                loadGrades(document.getElementById('admin-content'));
            } catch (error) {
                alert('Error al registrar la calificación.');
            }
        }
        

        async function loadSchedules(content) {
            content.innerHTML = '<h3>Cargando horarios...</h3>';
            try {
                const response = await axios.get(`${apiUrl}/generar_horario_tutor`, {
                    params: { id_usuario: 1 } // Reemplazar con datos reales
                });
                const horarios = response.data.reporte;
        
                let table = '<table class="table">';
                table += '<thead><tr><th>Día</th><th>Hora Inicio</th><th>Hora Fin</th><th>Acciones</th></tr></thead><tbody>';
                horarios.forEach(horario => {
                    table += `
                        <tr>
                            <td>${horario.dia}</td>
                            <td>${horario.hora_inicio}</td>
                            <td>${horario.hora_fin}</td>
                            <td>
                                <button class="btn btn-sm btn-warning" onclick="editSchedule(${horario.codigo_horario})">Editar</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteSchedule(${horario.codigo_horario})">Eliminar</button>
                            </td>
                        </tr>`;
                });
                table += '</tbody></table>';
                content.innerHTML = table;
            } catch (error) {
                content.innerHTML = '<p>Error al cargar horarios.</p>';
            }
        }
        
        function showAddScheduleForm() {
            document.getElementById('horarios-form').classList.remove('hidden');
            document.getElementById('horarios-list').classList.add('hidden');
        }
        
        function hideAddScheduleForm() {
            document.getElementById('horarios-form').classList.add('hidden');
            document.getElementById('horarios-list').classList.remove('hidden');
            document.getElementById('schedule-form').reset();
        }

        async function editSchedule(codigoH) {
            try {
                const response = await axios.get(`${apiUrl}/horarios/${codigoH}`);
                const horario = response.data;
                showAddScheduleForm();
                document.getElementById('hora-inicio').value = horario.hora_inicio;
                document.getElementById('hora-fin').value = horario.hora_fin;
                document.getElementById('dia-texto').value = horario.dia_texto;
            } catch (error) {
                alert('Error al cargar datos del horario.');
            }
        }
        
        async function deleteSchedule(codigoH) {
            if (confirm(`¿Estás seguro de eliminar el horario con código ${codigoH}?`)) {
                try {
                    await axios.delete(`${apiUrl}/eliminar-horario`, { data: { codigo_h: codigoH } });
                    alert('Horario eliminado exitosamente');
                    loadSchedules(document.getElementById('admin-content'));
                } catch (error) {
                    alert('Error al eliminar el horario.');
                }
            }
        }
        
        

        async function loadStudents(content) {
            content.innerHTML = '<h3>Cargando estudiantes...</h3>';
            try {
                const response = await axios.get(`${apiUrl}/reporte-estudiantes-aula`, {
                    params: { grupo: 1 } // Reemplazar con el grupo seleccionado
                });
                const estudiantes = response.data.reporte;
        
                let table = '<table class="table">';
                table += '<thead><tr><th>ID</th><th>Nombre</th><th>Grupo</th><th>Acciones</th></tr></thead><tbody>';
                estudiantes.forEach(estudiante => {
                    table += `
                        <tr>
                            <td>${estudiante.id_estudiante}</td>
                            <td>${estudiante.nombre_completo}</td>
                            <td>${estudiante.grupo}</td>
                            <td>
                                <button class="btn btn-sm btn-warning" onclick="editStudent('${estudiante.id_estudiante}')">Editar</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteStudent('${estudiante.id_estudiante}')">Eliminar</button>
                            </td>
                        </tr>`;
                });
                table += '</tbody></table>';
                content.innerHTML = table;
            } catch (error) {
                content.innerHTML = '<p>Error al cargar estudiantes.</p>';
            }
        }
        
        function showAddStudentForm() {
            document.getElementById('estudiantes-form').classList.remove('hidden');
            document.getElementById('estudiantes-list').classList.add('hidden');
        }
        
        function hideAddStudentForm() {
            document.getElementById('estudiantes-form').classList.add('hidden');
            document.getElementById('estudiantes-list').classList.remove('hidden');
            document.getElementById('student-form').reset();
        }
        
        async function addStudent(event) {
            event.preventDefault();
            const form = document.getElementById('student-form');
            const data = {
                tipo_id: document.getElementById('tipo-id').value,
                id_estudiante: document.getElementById('id-estudiante').value,
                primer_nombre: document.getElementById('primer-nombre').value,
                primer_apellido: document.getElementById('primer-apellido').value,
                grupo: document.getElementById('grupo').value,
                anio: new Date().getFullYear() // Año actual
            };
        
            try {
                await axios.post(`${apiUrl}/insertar-estudiante`, data);
                alert('Estudiante agregado exitosamente');
                hideAddStudentForm();
                loadStudents(document.getElementById('admin-content'));
            } catch (error) {
                alert('Error al agregar el estudiante.');
            }
        }
        
        async function deleteStudent(idEstudiante) {
            if (confirm(`¿Estás seguro de eliminar al estudiante con ID ${idEstudiante}?`)) {
                try {
                    await axios.delete(`${apiUrl}/eliminar-estudiante`, {
                        data: { id_estudiante: idEstudiante }
                    });
                    alert('Estudiante eliminado exitosamente');
                    loadStudents(document.getElementById('admin-content'));
                } catch (error) {
                    alert('Error al eliminar al estudiante.');
                }
            }
        }
        
        async function editStudent(idEstudiante) {
            try {
                const response = await axios.get(`${apiUrl}/reporte-estudiantes-aula`, {
                    params: { grupo: 1 } // Reemplazar con el grupo seleccionado
                });
                const estudiante = response.data.reporte.find(est => est.id_estudiante === idEstudiante);
                showAddStudentForm();
                document.getElementById('tipo-id').value = estudiante.tipo_id;
                document.getElementById('id-estudiante').value = estudiante.id_estudiante;
                document.getElementById('primer-nombre').value = estudiante.nombre_completo.split(' ')[0];
                document.getElementById('primer-apellido').value = estudiante.nombre_completo.split(' ')[1];
                document.getElementById('grupo').value = estudiante.grupo;
                document.getElementById('student-id').value = idEstudiante;
            } catch (error) {
                alert('Error al cargar datos del estudiante.');
            }
        }
        

        async function loadClasses(content) {
            content.innerHTML = '<h3>Cargando aulas...</h3>';
            try {
                const response = await axios.get(`${apiUrl}/generar_reporte_aulas`);
                const aulas = response.data.reporte;
        
                let table = '<table class="table">';
                table += '<thead><tr><th>Grupo</th><th>Grado</th><th>Jornada</th><th>Tutor</th><th>Acciones</th></tr></thead><tbody>';
                aulas.forEach(aula => {
                    table += `
                        <tr>
                            <td>${aula.grupo}</td>
                            <td>${aula.grado_t} (${aula.grado_num})</td>
                            <td>${aula.jornada}</td>
                            <td>${aula.tutor}</td>
                            <td>
                                <button class="btn btn-sm btn-warning" onclick="editAula(${aula.grupo})">Editar</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteAula(${aula.grupo})">Eliminar</button>
                            </td>
                        </tr>`;
                });
                table += '</tbody></table>';
                content.innerHTML = table;
            } catch (error) {
                content.innerHTML = '<p>Error al cargar las aulas.</p>';
            }
        }
        
        function showAddAulaForm() {
            document.getElementById('aulas-form').classList.remove('hidden');
            document.getElementById('aulas-list').classList.add('hidden');
        }
        
        function hideAddAulaForm() {
            document.getElementById('aulas-form').classList.add('hidden');
            document.getElementById('aulas-list').classList.remove('hidden');
            document.getElementById('aula-form').reset();
        }
        
        async function addAula(event) {
            event.preventDefault();
            const form = document.getElementById('aula-form');
            const data = {
                grado_t: document.getElementById('grado-t').value,
                grado_num: document.getElementById('grado-num').value,
                grupo_equivalente: document.getElementById('grupo-equiv').value,
                jornada: document.getElementById('jornada').value,
                codigo_insti: 1, // Reemplazar con datos reales
                id_usuario: 1    // Reemplazar con datos reales
            };
        
            try {
                await axios.post(`${apiUrl}/aulas/agregar`, data);
                alert('Aula agregada exitosamente');
                hideAddAulaForm();
                loadClasses(document.getElementById('admin-content'));
            } catch (error) {
                alert('Error al agregar el aula.');
            }
        }
        
        async function deleteAula(grupo) {
            if (confirm(`¿Estás seguro de eliminar el aula con grupo ${grupo}?`)) {
                try {
                    await axios.delete(`${apiUrl}/aulas/eliminar/${grupo}`);
                    alert('Aula eliminada exitosamente');
                    loadClasses(document.getElementById('admin-content'));
                } catch (error) {
                    alert('Error al eliminar el aula.');
                }
            }
        }
        
        async function editAula(grupo) {
            try {
                const response = await axios.get(`${apiUrl}/aulas/${grupo}`);
                const aula = response.data;
                showAddAulaForm();
                document.getElementById('grado-t').value = aula.grado_t;
                document.getElementById('grado-num').value = aula.grado_num;
                document.getElementById('grupo-equiv').value = aula.grupo_equivalente;
                document.getElementById('jornada').value = aula.jornada;
                document.getElementById('aula-grupo').value = grupo;
            } catch (error) {
                alert('Error al cargar el aula para edición.');
            }
        }
        

        

        // Inicio de sesión
        document.getElementById('login-form').addEventListener('submit', async (event) => {
            event.preventDefault();
            const identificacion = document.getElementById('identificacion').value;
            const password = document.getElementById('password').value;
        
            try {
                const response = await axios.post(`${apiUrl}/obtener-rol`, { identificacion, password });
                const roles = response.data.roles;
        
                if (roles.includes('Administrador')) {
                    document.getElementById('login-section').classList.add('hidden');
                    document.getElementById('admin-panel').classList.remove('hidden');
                } else if (roles.includes('Tutor')) {
                    document.getElementById('login-section').classList.add('hidden');
                    document.getElementById('tutor-panel').classList.remove('hidden');
                } else {
                    alert('Rol no reconocido.');
                }
            } catch (error) {
                alert('Error de autenticación: ' + (error.response?.data?.error || error.message));
            }
        });

        async function loadRoles(content) {
            content.innerHTML = '<h3>Cargando roles...</h3>';
            try {
                const response = await axios.get(`${apiUrl}/roles`);
                const roles = response.data;
        
                let table = '<table class="table">';
                table += '<thead><tr><th>ID</th><th>Nombre</th><th>Acciones</th></tr></thead><tbody>';
                roles.forEach(role => {
                    table += `
                        <tr>
                            <td>${role.id}</td>
                            <td>${role.name}</td>
                            <td>
                                <button class="btn btn-sm btn-warning" onclick="editRole(${role.id})">Editar</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteRole(${role.id})">Eliminar</button>
                            </td>
                        </tr>`;
                });
                table += '</tbody></table>';
                content.innerHTML = table;
            } catch (error) {
                content.innerHTML = '<p>Error al cargar roles.</p>';
            }
        }

        

        // Cargar secciones dinámicas
        async function loadAdminSection(section) {
            const content = document.getElementById('admin-content');
            content.innerHTML = `<h3>Cargando ${section}...</h3>`;

            if (section === 'users') await loadUsers(content);
            if (section === 'institutions') await loadInstitutions(content);
            if (section === 'classes') await loadClasses(content);
            if (section === 'students') await loadStudents(content);
            if (section === 'schedules') await loadSchedules(content);
            if (section === 'grades') await loadGrades(content);
            if (section === 'reports') await loadReports(content);
        }

        async function loadTutorSection(section) {
            const content = document.getElementById('tutor-content');
            content.innerHTML = `<h3>Cargando ${section}...</h3>`;
        }

        async function loadTutorReport() {
            const content = document.getElementById('reportes-content');
            content.innerHTML = '<h3>Cargando reporte de tutores...</h3>';
            try {
                const response = await axios.get(`${apiUrl}/reporte-tutores`);
                const tutores = response.data.reporte;
        
                let table = '<table class="table">';
                table += '<thead><tr><th>ID</th><th>Nombre</th><th>Correo</th><th>Teléfono</th></tr></thead><tbody>';
                tutores.forEach(tutor => {
                    table += `
                        <tr>
                            <td>${tutor.id_usuario}</td>
                            <td>${tutor.nombre} ${tutor.apellido}</td>
                            <td>${tutor.correo}</td>
                            <td>${tutor.telefono}</td>
                        </tr>`;
                });
                table += '</tbody></table>';
                content.innerHTML = table;
            } catch (error) {
                content.innerHTML = '<p>Error al cargar el reporte de tutores.</p>';
            }
        }
        

        // CRUD de Usuarios
        async function loadUsers(content) {
            try {
                const response = await axios.get(`${apiUrl}/reporte-usuarios`);
                const users = response.data.reporte;

                let table = '<h3>Gestión de Usuarios</h3><table class="table">';
                table += '<thead><tr><th>Nombre Completo</th><th>Rol</th><th>Correo</th><th>Teléfono</th></tr></thead><tbody>';
                users.forEach(user => {
                    table += `<tr><td>${user.nombre_completo}</td><td>${user.rol}</td><td>${user.correo}</td><td>${user.telefono}</td></tr>`;
                });
                table += '</tbody></table>';
                content.innerHTML = table;
            } catch (error) {
                content.innerHTML = '<p>Error al cargar usuarios.</p>';
            }
        }

        // CRUD de Instituciones
        async function loadInstitutions(content) {
            content.innerHTML = '<h3>Cargando instituciones...</h3>';
            try {
                const response = await axios.get(`${apiUrl}/reporte-instituciones`);
                const institutions = response.data.reporte;
        
                let table = '<table class="table">';
                table += '<thead><tr><th>Código</th><th>Nombre</th><th>Rector</th><th>Acciones</th></tr></thead><tbody>';
                institutions.forEach(inst => {
                    table += `
                        <tr>
                            <td>${inst.codigo}</td>
                            <td>${inst.nombre}</td>
                            <td>${inst.rector}</td>
                            <td>
                                <button class="btn btn-sm btn-warning" onclick="editInstitution('${inst.codigo}')">Editar</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteInstitution('${inst.codigo}')">Eliminar</button>
                            </td>
                        </tr>`;
                });
                table += '</tbody></table>';
                content.innerHTML = table;
            } catch (error) {
                content.innerHTML = '<p>Error al cargar instituciones.</p>';
            }
        }
        
        async function deleteInstitution(codigo) {
            if (confirm(`¿Estás seguro de eliminar la institución con código ${codigo}?`)) {
                try {
                    await axios.delete(`${apiUrl}/eliminar-institucion`, { data: { codigo_insti: codigo } });
                    alert('Institución eliminada exitosamente');
                    loadInstitutions(document.getElementById('admin-content'));
                } catch (error) {
                    alert('Error al eliminar la institución.');
                }
            }
        }
        
        function showAddInstitutionForm() {
            document.getElementById('institutions-form').classList.remove('hidden');
            document.getElementById('institutions-list').classList.add('hidden');
        }
        
        function hideAddInstitutionForm() {
            document.getElementById('institutions-form').classList.add('hidden');
            document.getElementById('institutions-list').classList.remove('hidden');
            document.getElementById('institution-form').reset();
        }
        
        async function addInstitution(event) {
            event.preventDefault();
            const data = {
                codigo_insti: document.getElementById('codigo-insti').value,
                nombre_insti: document.getElementById('nombre-insti').value,
                nombre_rector: document.getElementById('nombre-rector').value,
                localidad: document.getElementById('localidad').value
            };
        
            try {
                await axios.post(`${apiUrl}/agregar-institucion`, data);
                alert('Institución agregada exitosamente');
                hideAddInstitutionForm();
                loadInstitutions(document.getElementById('admin-content'));
            } catch (error) {
                alert('Error al agregar la institución.');
            }
        }
        
        async function editInstitution(codigo) {
            try {
                const response = await axios.get(`${apiUrl}/reporte-instituciones`);
                const institution = response.data.reporte.find(inst => inst.codigo === codigo);
                showAddInstitutionForm();
                document.getElementById('codigo-insti').value = institution.codigo;
                document.getElementById('nombre-insti').value = institution.nombre;
                document.getElementById('nombre-rector').value = institution.rector;
                document.getElementById('localidad').value = institution.localidad;
            } catch (error) {
                alert('Error al cargar datos de la institución.');
            }
        }

        async function loadInstitutions(content) {
            content.innerHTML = '<h3>Cargando instituciones...</h3>';
            try {
                const response = await axios.get(`${apiUrl}/reporte-instituciones`);
                const institutions = response.data.reporte;
        
                let table = '<table class="table">';
                table += '<thead><tr><th>Código</th><th>Nombre</th><th>Rector</th><th>Acciones</th></tr></thead><tbody>';
                institutions.forEach(inst => {
                    table += `
                        <tr>
                            <td>${inst.codigo}</td>
                            <td>${inst.nombre}</td>
                            <td>${inst.rector}</td>
                            <td>
                                <button class="btn btn-sm btn-warning" onclick="editInstitution('${inst.codigo}')">Editar</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteInstitution('${inst.codigo}')">Eliminar</button>
                            </td>
                        </tr>`;
                });
                table += '</tbody></table>';
                content.innerHTML = table;
            } catch (error) {
                content.innerHTML = '<p>Error al cargar instituciones.</p>';
            }
        }
        
        async function deleteInstitution(codigo) {
            if (confirm(`¿Estás seguro de eliminar la institución con código ${codigo}?`)) {
                try {
                    await axios.delete(`${apiUrl}/eliminar-institucion`, { data: { codigo_insti: codigo } });
                    alert('Institución eliminada exitosamente');
                    loadInstitutions(document.getElementById('admin-content'));
                } catch (error) {
                    alert('Error al eliminar la institución.');
                }
            }
        }
        
        function showAddInstitutionForm() {
            document.getElementById('institutions-form').classList.remove('hidden');
            document.getElementById('institutions-list').classList.add('hidden');
        }
        
        function hideAddInstitutionForm() {
            document.getElementById('institutions-form').classList.add('hidden');
            document.getElementById('institutions-list').classList.remove('hidden');
            document.getElementById('institution-form').reset();
        }
        
        async function addInstitution(event) {
            event.preventDefault();
            const data = {
                codigo_insti: document.getElementById('codigo-insti').value,
                nombre_insti: document.getElementById('nombre-insti').value,
                nombre_rector: document.getElementById('nombre-rector').value,
                localidad: document.getElementById('localidad').value
            };
        
            try {
                await axios.post(`${apiUrl}/agregar-institucion`, data);
                alert('Institución agregada exitosamente');
                hideAddInstitutionForm();
                loadInstitutions(document.getElementById('admin-content'));
            } catch (error) {
                alert('Error al agregar la institución.');
            }
        }
        
        async function editInstitution(codigo) {
            try {
                const response = await axios.get(`${apiUrl}/reporte-instituciones`);
                const institution = response.data.reporte.find(inst => inst.codigo === codigo);
                showAddInstitutionForm();
                document.getElementById('codigo-insti').value = institution.codigo;
                document.getElementById('nombre-insti').value = institution.nombre;
                document.getElementById('nombre-rector').value = institution.rector;
                document.getElementById('localidad').value = institution.localidad;
            } catch (error) {
                alert('Error al cargar datos de la institución.');
            }
        }
        
        

        // Función para cerrar sesión
        function logout() {
            document.getElementById('login-section').classList.remove('hidden');
            document.getElementById('admin-panel').classList.add('hidden');
            document.getElementById('tutor-panel').classList.add('hidden');
        }
    </script>
</body>
</html>
